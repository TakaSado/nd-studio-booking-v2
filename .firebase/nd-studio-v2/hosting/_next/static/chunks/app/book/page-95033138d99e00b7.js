(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[886],{6085:function(e,a,t){Promise.resolve().then(t.bind(t,3932))},3932:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var n=t(7437),l=t(2265);function r(e){let{steps:a,current:t}=e;return(0,n.jsx)("ol",{className:"flex items-center w-full",children:a.map((e,l)=>{let r=l<=t;return(0,n.jsxs)("li",{className:"flex-1 flex items-center",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full border ".concat(r?"bg-black text-white border-black":"border-gray-300 text-gray-400"),children:l+1}),(0,n.jsx)("div",{className:"ml-2 text-sm ".concat(r?"text-gray-900":"text-gray-400"),children:e.label}),l<a.length-1&&(0,n.jsx)("div",{className:"flex-1 h-px bg-gray-200 mx-3"})]},l)})})}function s(e){let{className:a="",variant:t="primary",...l}=e;return(0,n.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-2xl px-4 py-2 font-medium transition-colors shadow-soft disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-black text-white hover:bg-gray-800",secondary:"bg-accent text-gray-900 hover:opacity-90",ghost:"bg-transparent text-gray-900 hover:bg-gray-100 border border-gray-200"}[t]," ").concat(a),...l})}var i=t(9450);function o(e){let{value:a,onChange:t}=e,[r,s]=l.useState(i.ou.local().toISODate()),[o,c]=l.useState(i.ou.local().hour+1),d=Array.from({length:24},(e,a)=>a);return(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"date",className:"border rounded-2xl px-3 py-2",value:r,onChange:e=>s(e.target.value)}),(0,n.jsx)("select",{className:"border rounded-2xl px-3 py-2",value:o,onChange:e=>c(Number(e.target.value)),children:d.map(e=>(0,n.jsxs)("option",{value:e,children:[e.toString().padStart(2,"0"),":00"]},e))}),(0,n.jsx)("button",{className:"px-4 py-2 rounded-2xl bg-black text-white",onClick:()=>{let e=i.ou.fromISO("".concat(r,"T").concat(String(o).padStart(2,"0"),":00:00")),a=e.plus({hours:1});t({startISO:e.toISO(),endISO:a.toISO()})},children:"1時間で選択"}),a&&(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:["選択中: ",i.ou.fromISO(a.startISO).toFormat("yyyy/LL/dd HH:mm")," - ",i.ou.fromISO(a.endISO).toFormat("HH:mm")]})]})}var c=t(357);function d(){let[e,a]=l.useState(0),[t,i]=l.useState(null),[d,u]=l.useState({name:"",email:"",phone:""}),[x,m]=l.useState(!1),[h,p]=l.useState(null),[y,g]=l.useState("");async function b(){if(t){m(!0),g("空き状況を確認中...");try{let e=await fetch("/api/availability",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();if(!n.available){g("申し訳ありません、その時間は埋まっています。別時間をお試しください。");return}window.__bookingId=n.bookingId,a(1),g("空きあり。次へお進みください。")}finally{m(!1)}}}async function f(){m(!0),g("決済セッションを作成中...");try{let e=window.__bookingId,n=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:e,customer:d,startISO:t.startISO,endISO:t.endISO})}),l=await n.json();p(l.url),a(2),g("Stripe へ遷移できます。")}finally{m(!1)}}return(0,n.jsxs)("main",{className:"container-padded py-10",children:[(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(r,{steps:[{label:"日時選択"},{label:"お客様情報"},{label:"確認/決済"}],current:e})}),0===e&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(o,{value:t,onChange:i}),(0,n.jsx)("div",{children:(0,n.jsx)(s,{onClick:b,disabled:!t||x,children:"空き照会"})})]}),1===e&&(0,n.jsxs)("div",{className:"space-y-4 max-w-lg",children:[(0,n.jsx)("input",{className:"w-full border rounded-2xl px-3 py-2",placeholder:"氏名",value:d.name,onChange:e=>u({...d,name:e.target.value})}),(0,n.jsx)("input",{className:"w-full border rounded-2xl px-3 py-2",placeholder:"メール",value:d.email,onChange:e=>u({...d,email:e.target.value})}),(0,n.jsx)("input",{className:"w-full border rounded-2xl px-3 py-2",placeholder:"電話",value:d.phone,onChange:e=>u({...d,phone:e.target.value})}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(s,{variant:"ghost",onClick:()=>a(0),children:"戻る"}),(0,n.jsx)(s,{onClick:f,disabled:x||!d.name||!d.email||!d.phone,children:"決済へ"})]})]}),2===e&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{children:"以下のボタンで Stripe Checkout に進みます。"}),h&&(0,n.jsx)("a",{className:"inline-block",href:h,children:(0,n.jsx)(s,{children:"Stripe へ進む"})})]}),(0,n.jsx)("p",{className:"mt-8 text-sm text-gray-500",children:y}),(0,n.jsxs)("p",{className:"mt-2 text-xs text-gray-400",children:["緊急連絡先: ",c.env.NEXT_PUBLIC_SITE_NAME," 運営 / ",c.env.NEXT_PUBLIC_SUPPORT_PHONE," / ",c.env.NEXT_PUBLIC_SUPPORT_EMAIL]})]})}}},function(e){e.O(0,[91,971,23,744],function(){return e(e.s=6085)}),_N_E=e.O()}]);